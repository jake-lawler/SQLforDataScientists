<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Date and Time Functions | Notes on ‘SQL for Data Scientists’ by Renée M. P. Teate</title>
  <meta name="description" content="My Notes on ‘SQL for Data Scientists’." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Date and Time Functions | Notes on ‘SQL for Data Scientists’ by Renée M. P. Teate" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My Notes on ‘SQL for Data Scientists’." />
  <meta name="github-repo" content="jake-lawler/SQLforDataScientists" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Date and Time Functions | Notes on ‘SQL for Data Scientists’ by Renée M. P. Teate" />
  
  <meta name="twitter:description" content="My Notes on ‘SQL for Data Scientists’." />
  

<meta name="author" content="Jake Lawler" />


<meta name="date" content="2022-04-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="window_functions.html"/>
<link rel="next" href="exploratory_analysis.html"/>
<script src="libs/header-attrs-2.13/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="data_sources.html"><a href="data_sources.html"><i class="fa fa-check"></i><b>1</b> Data Sources</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data_sources.html"><a href="data_sources.html#chapter-notes"><i class="fa fa-check"></i><b>1.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="1.2" data-path="data_sources.html"><a href="data_sources.html#exercises"><i class="fa fa-check"></i><b>1.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="data_sources.html"><a href="data_sources.html#ex.-1"><i class="fa fa-check"></i>Ex. 1</a></li>
<li class="chapter" data-level="" data-path="data_sources.html"><a href="data_sources.html#ex.-2"><i class="fa fa-check"></i>Ex. 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="select.html"><a href="select.html"><i class="fa fa-check"></i><b>2</b> The SELECT Statement</a>
<ul>
<li class="chapter" data-level="2.1" data-path="select.html"><a href="select.html#chapter-notes-1"><i class="fa fa-check"></i><b>2.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="2.2" data-path="select.html"><a href="select.html#exercises-1"><i class="fa fa-check"></i><b>2.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="select.html"><a href="select.html#ex.-1-1"><i class="fa fa-check"></i>Ex. 1</a></li>
<li class="chapter" data-level="" data-path="select.html"><a href="select.html#ex.-2-1"><i class="fa fa-check"></i>Ex. 2</a></li>
<li class="chapter" data-level="" data-path="select.html"><a href="select.html#ex.-3"><i class="fa fa-check"></i>Ex. 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="where.html"><a href="where.html"><i class="fa fa-check"></i><b>3</b> The WHERE Clause</a>
<ul>
<li class="chapter" data-level="3.1" data-path="where.html"><a href="where.html#chapter-notes-2"><i class="fa fa-check"></i><b>3.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="3.2" data-path="where.html"><a href="where.html#exercises-2"><i class="fa fa-check"></i><b>3.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="where.html"><a href="where.html#ex.-1-2"><i class="fa fa-check"></i>Ex. 1</a></li>
<li class="chapter" data-level="" data-path="where.html"><a href="where.html#ex.-2-2"><i class="fa fa-check"></i>Ex. 2</a></li>
<li class="chapter" data-level="" data-path="where.html"><a href="where.html#ex.-3-1"><i class="fa fa-check"></i>Ex. 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="case.html"><a href="case.html"><i class="fa fa-check"></i><b>4</b> CASE Statements</a>
<ul>
<li class="chapter" data-level="4.1" data-path="case.html"><a href="case.html#chapter-notes-3"><i class="fa fa-check"></i><b>4.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="4.2" data-path="case.html"><a href="case.html#exercises-3"><i class="fa fa-check"></i><b>4.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="case.html"><a href="case.html#ex.-1-3"><i class="fa fa-check"></i>Ex. 1</a></li>
<li class="chapter" data-level="" data-path="case.html"><a href="case.html#ex.-2-3"><i class="fa fa-check"></i>Ex. 2</a></li>
<li class="chapter" data-level="" data-path="case.html"><a href="case.html#ex.-3-2"><i class="fa fa-check"></i>Ex. 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sql_joins.html"><a href="sql_joins.html"><i class="fa fa-check"></i><b>5</b> SQL JOINs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sql_joins.html"><a href="sql_joins.html#chapter-notes-4"><i class="fa fa-check"></i><b>5.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="5.2" data-path="sql_joins.html"><a href="sql_joins.html#exercises-4"><i class="fa fa-check"></i><b>5.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="sql_joins.html"><a href="sql_joins.html#ex.-1-4"><i class="fa fa-check"></i>Ex. 1</a></li>
<li class="chapter" data-level="" data-path="sql_joins.html"><a href="sql_joins.html#ex.-2-4"><i class="fa fa-check"></i>Ex. 2</a></li>
<li class="chapter" data-level="" data-path="sql_joins.html"><a href="sql_joins.html#ex.-3-3"><i class="fa fa-check"></i>Ex. 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="aggregating.html"><a href="aggregating.html"><i class="fa fa-check"></i><b>6</b> Aggregating Results for Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="aggregating.html"><a href="aggregating.html#chapter-notes-5"><i class="fa fa-check"></i><b>6.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="6.2" data-path="aggregating.html"><a href="aggregating.html#exercises-5"><i class="fa fa-check"></i><b>6.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="aggregating.html"><a href="aggregating.html#ex.-1-5"><i class="fa fa-check"></i>Ex. 1</a></li>
<li class="chapter" data-level="" data-path="aggregating.html"><a href="aggregating.html#ex.-2-5"><i class="fa fa-check"></i>Ex. 2</a></li>
<li class="chapter" data-level="" data-path="aggregating.html"><a href="aggregating.html#ex.-3-4"><i class="fa fa-check"></i>Ex. 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="window_functions.html"><a href="window_functions.html"><i class="fa fa-check"></i><b>7</b> Window Functions and Subqueries</a>
<ul>
<li class="chapter" data-level="7.1" data-path="window_functions.html"><a href="window_functions.html#chapter-notes-6"><i class="fa fa-check"></i><b>7.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="7.2" data-path="window_functions.html"><a href="window_functions.html#exercises-6"><i class="fa fa-check"></i><b>7.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="window_functions.html"><a href="window_functions.html#ex.-1-6"><i class="fa fa-check"></i>Ex. 1</a></li>
<li class="chapter" data-level="" data-path="window_functions.html"><a href="window_functions.html#ex.-2-6"><i class="fa fa-check"></i>Ex. 2</a></li>
<li class="chapter" data-level="" data-path="window_functions.html"><a href="window_functions.html#ex.-3-5"><i class="fa fa-check"></i>Ex. 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="date_time.html"><a href="date_time.html"><i class="fa fa-check"></i><b>8</b> Date and Time Functions</a>
<ul>
<li class="chapter" data-level="8.1" data-path="date_time.html"><a href="date_time.html#chapter-notes-7"><i class="fa fa-check"></i><b>8.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="8.2" data-path="date_time.html"><a href="date_time.html#exercises-7"><i class="fa fa-check"></i><b>8.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="date_time.html"><a href="date_time.html#ex.-1-7"><i class="fa fa-check"></i>Ex. 1</a></li>
<li class="chapter" data-level="" data-path="date_time.html"><a href="date_time.html#ex.-2-7"><i class="fa fa-check"></i>Ex. 2</a></li>
<li class="chapter" data-level="" data-path="date_time.html"><a href="date_time.html#ex.-3-6"><i class="fa fa-check"></i>Ex. 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="date_time.html"><a href="date_time.html#further-reading"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="exploratory_analysis.html"><a href="exploratory_analysis.html"><i class="fa fa-check"></i><b>9</b> Exploratory Data Analysis with SQL</a>
<ul>
<li class="chapter" data-level="9.1" data-path="exploratory_analysis.html"><a href="exploratory_analysis.html#chapter-notes-8"><i class="fa fa-check"></i><b>9.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="9.2" data-path="exploratory_analysis.html"><a href="exploratory_analysis.html#exercises-8"><i class="fa fa-check"></i><b>9.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="exploratory_analysis.html"><a href="exploratory_analysis.html#ex.-1-8"><i class="fa fa-check"></i>Ex. 1</a></li>
<li class="chapter" data-level="" data-path="exploratory_analysis.html"><a href="exploratory_analysis.html#ex.-2-8"><i class="fa fa-check"></i>Ex. 2</a></li>
<li class="chapter" data-level="" data-path="exploratory_analysis.html"><a href="exploratory_analysis.html#ex.-3-7"><i class="fa fa-check"></i>Ex. 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exploratory_analysis.html"><a href="exploratory_analysis.html#further-reading-1"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="building_datasets.html"><a href="building_datasets.html"><i class="fa fa-check"></i><b>10</b> Building SQL Datasets for Analytical Reporting</a>
<ul>
<li class="chapter" data-level="10.1" data-path="building_datasets.html"><a href="building_datasets.html#chapter-notes-9"><i class="fa fa-check"></i><b>10.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="10.2" data-path="building_datasets.html"><a href="building_datasets.html#exercises-9"><i class="fa fa-check"></i><b>10.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="building_datasets.html"><a href="building_datasets.html#ex.-1-9"><i class="fa fa-check"></i>Ex. 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="building_datasets.html"><a href="building_datasets.html#further-reading-2"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes on ‘SQL for Data Scientists’ by Renée M. P. Teate</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="date_time" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> Date and Time Functions</h1>
<div id="chapter-notes-7" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Chapter Notes</h2>
<p>The chapter title is pretty self-explanatory for this one.</p>
<p>The chapter opens by creating a demo table that will be used throughout the chapter. Here’s the code to do that:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb77-1"><a href="date_time.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> farmers_market.datetime_demo <span class="kw">AS</span> </span>
<span id="cb77-2"><a href="date_time.html#cb77-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb77-3"><a href="date_time.html#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> market_date, </span>
<span id="cb77-4"><a href="date_time.html#cb77-4" aria-hidden="true" tabindex="-1"></a>          market_start_time, </span>
<span id="cb77-5"><a href="date_time.html#cb77-5" aria-hidden="true" tabindex="-1"></a>          market_end_time, </span>
<span id="cb77-6"><a href="date_time.html#cb77-6" aria-hidden="true" tabindex="-1"></a>          STR_TO_DATE(<span class="fu">CONCAT</span>(market_date, <span class="st">&#39; &#39;</span>, market_start_time), <span class="st">&#39;%Y-%m-%d %h:%i %p&#39;</span>) <span class="kw">AS</span> market_start_datetime,</span>
<span id="cb77-7"><a href="date_time.html#cb77-7" aria-hidden="true" tabindex="-1"></a>          STR_TO_DATE(<span class="fu">CONCAT</span>(market_date, <span class="st">&#39; &#39;</span>, market_end_time), <span class="st">&#39;%Y-%m-%d %h:%i %p&#39;</span>) <span class="kw">AS</span> market_end_datetime </span>
<span id="cb77-8"><a href="date_time.html#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> farmers_market.market_date_info</span>
<span id="cb77-9"><a href="date_time.html#cb77-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Table creation is covered later, in chapter 14. The columns market_start_datetime and market_end_datetime are datetime values, converted from strings using the STR_TO_DATE function. We tell the function what format to expect with the string ‘%Y-%m-%d %h:%i %p’. Here’s what the created table looks like:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb78-1"><a href="date_time.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb78-2"><a href="date_time.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> datetime_demo</span>
<span id="cb78-3"><a href="date_time.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">5</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-3">Table 2.2: </span>5 records</caption>
<colgroup>
<col width="13%" />
<col width="20%" />
<col width="18%" />
<col width="25%" />
<col width="22%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">market_date</th>
<th align="left">market_start_time</th>
<th align="left">market_end_time</th>
<th align="left">market_start_datetime</th>
<th align="left">market_end_datetime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-03-02</td>
<td align="left">8:00 AM</td>
<td align="left">2:00 PM</td>
<td align="left">2019-03-02 08:00:00</td>
<td align="left">2019-03-02 14:00:00</td>
</tr>
<tr class="even">
<td align="left">2019-03-09</td>
<td align="left">9:00 AM</td>
<td align="left">2:00 PM</td>
<td align="left">2019-03-09 09:00:00</td>
<td align="left">2019-03-09 14:00:00</td>
</tr>
<tr class="odd">
<td align="left">2019-03-13</td>
<td align="left">4:00 PM</td>
<td align="left">7:00 PM</td>
<td align="left">2019-03-13 16:00:00</td>
<td align="left">2019-03-13 19:00:00</td>
</tr>
<tr class="even">
<td align="left">2019-03-16</td>
<td align="left">8:00 AM</td>
<td align="left">2:00 PM</td>
<td align="left">2019-03-16 08:00:00</td>
<td align="left">2019-03-16 14:00:00</td>
</tr>
<tr class="odd">
<td align="left">2019-03-20</td>
<td align="left">4:00 PM</td>
<td align="left">7:00 PM</td>
<td align="left">2019-03-20 16:00:00</td>
<td align="left">2019-03-20 19:00:00</td>
</tr>
</tbody>
</table>
</div>
<p>The function name and syntax for the extracting part of a datetime value varies by database system. For MySQL it is EXTRACT, but it could be DATE_PART or DATEPART in other systems. MySQL also has DATE and TIME functions to extract those parts of a datetime value only. E.g.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb79-1"><a href="date_time.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> market_start_datetime, </span>
<span id="cb79-2"><a href="date_time.html#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">EXTRACT</span>(<span class="dt">DAY</span> <span class="kw">FROM</span> market_start_datetime) <span class="kw">AS</span> mktsrt_day, </span>
<span id="cb79-3"><a href="date_time.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">EXTRACT</span>(<span class="dt">MONTH</span> <span class="kw">FROM</span> market_start_datetime) <span class="kw">AS</span> mktsrt_month, </span>
<span id="cb79-4"><a href="date_time.html#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> market_start_datetime) <span class="kw">AS</span> mktsrt_year, </span>
<span id="cb79-5"><a href="date_time.html#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">EXTRACT</span>(<span class="kw">HOUR</span> <span class="kw">FROM</span> market_start_datetime) <span class="kw">AS</span> mktsrt_hour,</span>
<span id="cb79-6"><a href="date_time.html#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">EXTRACT</span>(<span class="kw">MINUTE</span> <span class="kw">FROM</span> market_start_datetime) <span class="kw">AS</span> mktsrt_minute,</span>
<span id="cb79-7"><a href="date_time.html#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">DATE</span>(market_start_datetime) <span class="kw">AS</span> mktsrt_date,</span>
<span id="cb79-8"><a href="date_time.html#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">TIME</span>(market_start_datetime) <span class="kw">AS</span> mktsrt_time</span>
<span id="cb79-9"><a href="date_time.html#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> farmers_market.datetime_demo</span>
<span id="cb79-10"><a href="date_time.html#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> market_start_datetime <span class="op">=</span> <span class="st">&#39;2019-03-02 08:00:00&#39;</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-4">Table 2.3: </span>1 records</caption>
<colgroup>
<col width="20%" />
<col width="10%" />
<col width="12%" />
<col width="11%" />
<col width="11%" />
<col width="12%" />
<col width="11%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">market_start_datetime</th>
<th align="right">mktsrt_day</th>
<th align="right">mktsrt_month</th>
<th align="right">mktsrt_year</th>
<th align="right">mktsrt_hour</th>
<th align="right">mktsrt_minute</th>
<th align="left">mktsrt_date</th>
<th align="left">mktsrt_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-03-02 08:00:00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">2019</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="left">2019-03-02</td>
<td align="left">08:00:00</td>
</tr>
</tbody>
</table>
</div>
<p>The chapter introduces the DATE_ADD and DATE_SUB functions:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb80-1"><a href="date_time.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> market_start_datetime, </span>
<span id="cb80-2"><a href="date_time.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  DATE_ADD(market_start_datetime, <span class="dt">INTERVAL</span> <span class="dv">30</span> <span class="kw">MINUTE</span>) <span class="kw">AS</span> mktstrt_date_plus_30min,</span>
<span id="cb80-3"><a href="date_time.html#cb80-3" aria-hidden="true" tabindex="-1"></a>  DATE_ADD(market_start_datetime, <span class="dt">INTERVAL</span> <span class="dv">30</span> <span class="dt">DAY</span>) <span class="kw">AS</span> mktstrt_date_plus_30day,</span>
<span id="cb80-4"><a href="date_time.html#cb80-4" aria-hidden="true" tabindex="-1"></a>  DATE_SUB(</span>
<span id="cb80-5"><a href="date_time.html#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">DATE</span>(market_start_datetime), <span class="dt">INTERVAL</span> <span class="dv">30</span> <span class="dt">DAY</span>) <span class="kw">AS</span> mktstrt_day_minus_30day</span>
<span id="cb80-6"><a href="date_time.html#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> farmers_market.datetime_demo</span>
<span id="cb80-7"><a href="date_time.html#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> market_start_datetime <span class="op">=</span> <span class="st">&#39;2019-03-02 08:00:00&#39;</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-5">Table 0.1: </span>1 records</caption>
<colgroup>
<col width="23%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">market_start_datetime</th>
<th align="left">mktstrt_date_plus_30min</th>
<th align="left">mktstrt_date_plus_30day</th>
<th align="left">mktstrt_day_minus_30day</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-03-02 08:00:00</td>
<td align="left">2019-03-02 08:30:00</td>
<td align="left">2019-04-01 08:00:00</td>
<td align="left">2019-01-31</td>
</tr>
</tbody>
</table>
</div>
<p>Instead of using DATE_SUB you can also use DATE_ADD with negative numbers.</p>
<p>We can get the difference between two dates with the DATEDIFF function. The following code uses a subquery to find the first and last dates in the data and then finds the difference between them.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb81-1"><a href="date_time.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x.first_market, x.last_market, </span>
<span id="cb81-2"><a href="date_time.html#cb81-2" aria-hidden="true" tabindex="-1"></a>        DATEDIFF(x.last_market, x.first_market) <span class="kw">AS</span> days_first_to_last</span>
<span id="cb81-3"><a href="date_time.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> (</span>
<span id="cb81-4"><a href="date_time.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="fu">min</span>(market_start_datetime) <span class="kw">AS</span> first_market, </span>
<span id="cb81-5"><a href="date_time.html#cb81-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">max</span>(market_start_datetime) last_market </span>
<span id="cb81-6"><a href="date_time.html#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> farmers_market.datetime_demo</span>
<span id="cb81-7"><a href="date_time.html#cb81-7" aria-hidden="true" tabindex="-1"></a>) <span class="kw">AS</span> x</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-6">Table 2.4: </span>1 records</caption>
<thead>
<tr class="header">
<th align="left">first_market</th>
<th align="left">last_market</th>
<th align="right">days_first_to_last</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-03-02 08:00:00</td>
<td align="left">2020-10-10 08:00:00</td>
<td align="right">588</td>
</tr>
</tbody>
</table>
</div>
<p>A more general version of this function in MySQL TIMESTAMPDIFF, which returns answers in any chosen format e.g:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb82-1"><a href="date_time.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> x.first_market, x.last_market, </span>
<span id="cb82-2"><a href="date_time.html#cb82-2" aria-hidden="true" tabindex="-1"></a>        TIMESTAMPDIFF(<span class="kw">HOUR</span>, x.first_market, x.last_market) <span class="kw">AS</span> hours_first_to_last</span>
<span id="cb82-3"><a href="date_time.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> (</span>
<span id="cb82-4"><a href="date_time.html#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="fu">min</span>(market_start_datetime) <span class="kw">AS</span> first_market, </span>
<span id="cb82-5"><a href="date_time.html#cb82-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">max</span>(market_start_datetime) last_market </span>
<span id="cb82-6"><a href="date_time.html#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> farmers_market.datetime_demo</span>
<span id="cb82-7"><a href="date_time.html#cb82-7" aria-hidden="true" tabindex="-1"></a>) <span class="kw">AS</span> x</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-7">Table 2.5: </span>1 records</caption>
<thead>
<tr class="header">
<th align="left">first_market</th>
<th align="left">last_market</th>
<th align="right">hours_first_to_last</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-03-02 08:00:00</td>
<td align="left">2020-10-10 08:00:00</td>
<td align="right">14112</td>
</tr>
</tbody>
</table>
</div>
<p>Notice that the syntax is reversed for start and end dates for DATEDIFF and TIMESTAMPDIFF. Other database systems allow specification of the interval in DATEDIFF.</p>
<p>To get the current date, MySQL uses CURDATE, but other systems may use CURRENT_DATE, TODAY, SYSDATE, or GETDATE.</p>
<p>The chapter describes using date functions with aggregates and window functions. For example, in the code below we use date functions with aggregation over customer_id:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb83-1"><a href="date_time.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> customer_id, </span>
<span id="cb83-2"><a href="date_time.html#cb83-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MIN</span>(market_date) <span class="kw">AS</span> first_purchase, </span>
<span id="cb83-3"><a href="date_time.html#cb83-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MAX</span>(market_date) <span class="kw">AS</span> last_purchase, </span>
<span id="cb83-4"><a href="date_time.html#cb83-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> market_date) <span class="kw">AS</span> count_of_purchase_dates</span>
<span id="cb83-5"><a href="date_time.html#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> farmers_market.customer_purchases</span>
<span id="cb83-6"><a href="date_time.html#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> customer_id</span>
<span id="cb83-7"><a href="date_time.html#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">5</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-8">Table 2.6: </span>5 records</caption>
<thead>
<tr class="header">
<th align="left">customer_id</th>
<th align="left">first_purchase</th>
<th align="left">last_purchase</th>
<th align="right">count_of_purchase_dates</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">2019-04-06</td>
<td align="left">2020-10-10</td>
<td align="right">107</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">2019-04-06</td>
<td align="left">2020-10-10</td>
<td align="right">117</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">2019-04-03</td>
<td align="left">2020-10-07</td>
<td align="right">112</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">2019-04-03</td>
<td align="left">2020-10-03</td>
<td align="right">115</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">2019-04-03</td>
<td align="left">2020-10-10</td>
<td align="right">113</td>
</tr>
</tbody>
</table>
</div>
<p>And here is an example of date functions used with window functions:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb84-1"><a href="date_time.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> customer_id, market_date, </span>
<span id="cb84-2"><a href="date_time.html#cb84-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> market_date) <span class="kw">AS</span> purchase_number, </span>
<span id="cb84-3"><a href="date_time.html#cb84-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">LEAD</span>(market_date,<span class="dv">1</span>) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> market_date) <span class="kw">AS</span> next_purchase </span>
<span id="cb84-4"><a href="date_time.html#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> farmers_market.customer_purchases</span>
<span id="cb84-5"><a href="date_time.html#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> customer_id <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb84-6"><a href="date_time.html#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">5</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-9">Table 3.1: </span>5 records</caption>
<thead>
<tr class="header">
<th align="right">customer_id</th>
<th align="left">market_date</th>
<th align="right">purchase_number</th>
<th align="left">next_purchase</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2019-04-06</td>
<td align="right">1</td>
<td align="left">2019-04-13</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2019-04-13</td>
<td align="right">2</td>
<td align="left">2019-04-17</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2019-04-17</td>
<td align="right">3</td>
<td align="left">2019-04-17</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">2019-04-17</td>
<td align="right">3</td>
<td align="left">2019-04-20</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">2019-04-20</td>
<td align="right">5</td>
<td align="left">2019-04-20</td>
</tr>
</tbody>
</table>
</div>
<p>For customer_id 1, we rank the purchases from earliest to latest, and then create a column with the date of the next purchase. We can use this to calculate the time between purchases. You can see that the code doesn’t quite work when the customer made multiple purchases on the same date. The chapter presents a couple ways of correcting this.</p>
<p>Here are a couple of ways of finding the customers who only made one purchase in March 2020. The chapter does this slightly differently.</p>
<p>With subqueries:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb85-1"><a href="date_time.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb85-2"><a href="date_time.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> (</span>
<span id="cb85-3"><a href="date_time.html#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> customer_id,</span>
<span id="cb85-4"><a href="date_time.html#cb85-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">COUNT</span>(market_date) <span class="kw">AS</span> num_purchases</span>
<span id="cb85-5"><a href="date_time.html#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> customer_purchases</span>
<span id="cb85-6"><a href="date_time.html#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> <span class="fu">EXTRACT</span>(<span class="dt">MONTH</span> <span class="kw">FROM</span> market_date) <span class="op">=</span> <span class="dv">3</span> <span class="kw">AND</span></span>
<span id="cb85-7"><a href="date_time.html#cb85-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> market_date) <span class="op">=</span> <span class="dv">2020</span></span>
<span id="cb85-8"><a href="date_time.html#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> customer_id</span>
<span id="cb85-9"><a href="date_time.html#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> customer_id</span>
<span id="cb85-10"><a href="date_time.html#cb85-10" aria-hidden="true" tabindex="-1"></a>) <span class="kw">AS</span> x</span>
<span id="cb85-11"><a href="date_time.html#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> x.num_purchases <span class="op">=</span> <span class="dv">1</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-10">Table 3.2: </span>1 records</caption>
<thead>
<tr class="header">
<th align="right">customer_id</th>
<th align="right">num_purchases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">26</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<p>With the HAVING clause:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb86-1"><a href="date_time.html#cb86-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> customer_id,</span>
<span id="cb86-2"><a href="date_time.html#cb86-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">COUNT</span>(market_date) <span class="kw">AS</span> num_purchases</span>
<span id="cb86-3"><a href="date_time.html#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> customer_purchases</span>
<span id="cb86-4"><a href="date_time.html#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> <span class="fu">EXTRACT</span>(<span class="dt">MONTH</span> <span class="kw">FROM</span> market_date) <span class="op">=</span> <span class="dv">3</span> <span class="kw">AND</span></span>
<span id="cb86-5"><a href="date_time.html#cb86-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> market_date) <span class="op">=</span> <span class="dv">2020</span></span>
<span id="cb86-6"><a href="date_time.html#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> customer_id</span>
<span id="cb86-7"><a href="date_time.html#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">HAVING</span> <span class="fu">COUNT</span>(market_date) <span class="op">=</span><span class="dv">1</span></span>
<span id="cb86-8"><a href="date_time.html#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> customer_id</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-11">Table 2.7: </span>1 records</caption>
<thead>
<tr class="header">
<th align="right">customer_id</th>
<th align="right">num_purchases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">26</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="exercises-7" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Exercises</h2>
<div id="ex.-1-7" class="section level3 unnumbered">
<h3>Ex. 1</h3>
<div id="question-20" class="section level4 unnumbered">
<h4>Question</h4>
<blockquote>
<p>Get the customer_id , month, and year (in separate columns) of every purchase in the farmers_market.customer_purchases table.</p>
</blockquote>
</div>
<div id="answer-20" class="section level4 unnumbered">
<h4>Answer</h4>
<div class="sourceCode" id="cb87"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb87-1"><a href="date_time.html#cb87-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span>  customer_id, market_date,</span>
<span id="cb87-2"><a href="date_time.html#cb87-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">EXTRACT</span>(<span class="dt">MONTH</span> <span class="kw">FROM</span> market_date) <span class="kw">AS</span> <span class="dt">month</span>,</span>
<span id="cb87-3"><a href="date_time.html#cb87-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">EXTRACT</span>(<span class="dt">YEAR</span> <span class="kw">FROM</span> market_date) <span class="kw">AS</span> <span class="dt">year</span></span>
<span id="cb87-4"><a href="date_time.html#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> customer_purchases</span>
<span id="cb87-5"><a href="date_time.html#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> market_date, transaction_time</span>
<span id="cb87-6"><a href="date_time.html#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">LIMIT</span> <span class="dv">5</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-12">Table 2.8: </span>5 records</caption>
<thead>
<tr class="header">
<th align="right">customer_id</th>
<th align="left">market_date</th>
<th align="right">month</th>
<th align="right">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">9</td>
<td align="left">2019-04-03</td>
<td align="right">4</td>
<td align="right">2019</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="left">2019-04-03</td>
<td align="right">4</td>
<td align="right">2019</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">2019-04-03</td>
<td align="right">4</td>
<td align="right">2019</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="left">2019-04-03</td>
<td align="right">4</td>
<td align="right">2019</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">2019-04-03</td>
<td align="right">4</td>
<td align="right">2019</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="ex.-2-7" class="section level3 unnumbered">
<h3>Ex. 2</h3>
<div id="question-21" class="section level4 unnumbered">
<h4>Question</h4>
<blockquote>
<p>Write a query that filters to purchases made in the past two weeks, returns the earliest market_date in that range as a field called sales_since_date , and a sum of the sales ( quantity * cost_to_customer_per_qty ) during that date range.</p>
</blockquote>
</div>
<div id="answer-21" class="section level4 unnumbered">
<h4>Answer</h4>
<p>There are no purchases in the database from the last two weeks. Otherwise would use CURDATE in place of ‘2020-10-10’.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb88-1"><a href="date_time.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MIN</span>(market_date) <span class="kw">AS</span> sales_since_date,</span>
<span id="cb88-2"><a href="date_time.html#cb88-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">SUM</span>(quantity <span class="op">*</span> cost_to_customer_per_qty) <span class="kw">AS</span> sum_of_sales</span>
<span id="cb88-3"><a href="date_time.html#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> customer_purchases</span>
<span id="cb88-4"><a href="date_time.html#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> DATEDIFF(<span class="st">&#39;2020-10-10&#39;</span>, market_date) <span class="op">&lt;</span> <span class="dv">14</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-13">Table 2.9: </span>1 records</caption>
<thead>
<tr class="header">
<th align="left">sales_since_date</th>
<th align="right">sum_of_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2020-09-30</td>
<td align="right">2233.764</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="ex.-3-6" class="section level3 unnumbered">
<h3>Ex. 3</h3>
<div id="question-22" class="section level4 unnumbered">
<h4>Question</h4>
<blockquote>
<p>In MySQL, there is a DAYNAME() function that returns the full name of the day of the week on which a date occurs. Query the Farmer’s Market database market_date_info table, return the market_date , the market_day , and your calculated day of the week name that each market_date occurred on.
Create a calculated column using a CASE statement that indicates whether the recorded day in the database differs from your calculated day of the week. This is an example of a quality control query that could be used to check manually entered data for correctness.</p>
</blockquote>
</div>
<div id="answer-22" class="section level4 unnumbered">
<h4>Answer</h4>
<div class="sourceCode" id="cb89"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb89-1"><a href="date_time.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> market_date, market_day, DAYNAME(market_date) <span class="kw">AS</span> calc_market_day,</span>
<span id="cb89-2"><a href="date_time.html#cb89-2" aria-hidden="true" tabindex="-1"></a>        <span class="cf">CASE</span> </span>
<span id="cb89-3"><a href="date_time.html#cb89-3" aria-hidden="true" tabindex="-1"></a>          <span class="cf">WHEN</span> market_day <span class="op">=</span> DAYNAME(market_date)</span>
<span id="cb89-4"><a href="date_time.html#cb89-4" aria-hidden="true" tabindex="-1"></a>          <span class="cf">THEN</span> <span class="dv">1</span></span>
<span id="cb89-5"><a href="date_time.html#cb89-5" aria-hidden="true" tabindex="-1"></a>          <span class="cf">ELSE</span> <span class="dv">0</span> </span>
<span id="cb89-6"><a href="date_time.html#cb89-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">END</span> <span class="kw">AS</span> check_match</span>
<span id="cb89-7"><a href="date_time.html#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> market_date_info</span>
<span id="cb89-8"><a href="date_time.html#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> check_match <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb89-9"><a href="date_time.html#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">5</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-14">Table 3.3: </span>5 records</caption>
<thead>
<tr class="header">
<th align="left">market_date</th>
<th align="left">market_day</th>
<th align="left">calc_market_day</th>
<th align="right">check_match</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-03-02</td>
<td align="left">Saturday</td>
<td align="left">Saturday</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">2019-03-09</td>
<td align="left">Saturday</td>
<td align="left">Saturday</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">2019-03-13</td>
<td align="left">Wednesday</td>
<td align="left">Wednesday</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">2019-03-16</td>
<td align="left">Saturday</td>
<td align="left">Saturday</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">2019-03-20</td>
<td align="left">Wednesday</td>
<td align="left">Wednesday</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="further-reading" class="section level2 unnumbered">
<h2>Further Reading</h2>
<p><a href="dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html">MySQL 8.0 Date and time functions documentation.</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="window_functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploratory_analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/08-date_time.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
